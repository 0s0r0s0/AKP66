<Window x:Class="PokerTournamentDirector.Views.TournamentTemplateView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PokerTournamentDirector.Models"
        Title="📝 Modèles de Tournois"
        Height="850" Width="1500"
        Background="#1a1a2e"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">
    <Window.Resources>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="#16213e"/>
            <Setter Property="CornerRadius" Value="15"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="10"/>
        </Style>
        <Style x:Key="TitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>
        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#a0a0a0"/>
            <Setter Property="Margin" Value="0,6,0,4"/>
        </Style>
        <Style x:Key="TextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#0f3460" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderBrush" Value="#00ff88" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="Padding" Value="10,8" />
            <Setter Property="MinHeight" Value="38" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Focusable="False"
                                          HorizontalScrollBarVisibility="Hidden"
                                          VerticalScrollBarVisibility="Hidden" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#00ff88" />
                                <Setter TargetName="Bd" Property="BorderThickness" Value="2" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#00ff88" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ComboBoxStyle" TargetType="ComboBox">
            <!-- Fond et couleurs cohérents avec ton thème poker -->
            <Setter Property="Background" Value="#0f3460" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderBrush" Value="#00ff88" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="FontSize" Value="15" />
            <!-- Même taille que les TextBox -->

            <!-- Ce qui corrige le texte écrasé -->
            <Setter Property="Padding" Value="12,10" />
            <!-- Espace intérieur généreux -->
            <Setter Property="MinHeight" Value="38" />
            <!-- Hauteur minimale confortable -->
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <!-- Texte centré verticalement -->

            <!-- Coins arrondis + template complet -->
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                          BorderBrush="{TemplateBinding BorderBrush}"
                          BorderThickness="{TemplateBinding BorderThickness}"
                          Background="{TemplateBinding Background}"
                          Focusable="False"
                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                          ClickMode="Press">
                                <ToggleButton.Template>
                                    <ControlTemplate>
                                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                SnapsToDevicePixels="True">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <ContentPresenter Grid.Column="0"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Left"
                                                  Margin="12,0,0,0" />
                                                <!-- Flèche du dropdown -->
                                                <Path Grid.Column="1"
                                      Data="M0,0 L4,4 L8,0 Z"
                                      Fill="White"
                                      Margin="0,0,12,0"
                                      VerticalAlignment="Center"
                                      HorizontalAlignment="Right" />
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <!-- Effet focus -->
                                            <Trigger Property="IsFocused" Value="True">
                                                <Setter TargetName="Bd" Property="BorderBrush" Value="#00ff88" />
                                                <Setter TargetName="Bd" Property="BorderThickness" Value="3" />
                                                <Setter TargetName="Bd" Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="#00ff88" Direction="320" ShadowDepth="0" BlurRadius="8" Opacity="0.6" />
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                            <!-- Survol -->
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Bd" Property="BorderBrush" Value="#00ff88" />
                                            </Trigger>
                                            <!-- Désactivé -->
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Opacity" Value="0.5" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>

                            <ContentPresenter x:Name="ContentSite"
                              IsHitTestVisible="False"
                              Content="{TemplateBinding SelectionBoxItem}"
                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                              ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                              Margin="12,0,30,0"
                              VerticalAlignment="Center"
                              HorizontalAlignment="Left" />

                            <Popup x:Name="Popup"
                   Placement="Bottom"
                   IsOpen="{TemplateBinding IsDropDownOpen}"
                   AllowsTransparency="True"
                   Focusable="False"
                   PopupAnimation="Slide">
                                <Grid x:Name="DropDown"
                      SnapsToDevicePixels="True"
                      MinWidth="{TemplateBinding ActualWidth}"
                      MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                    <Border x:Name="DropDownBorder"
                            Background="#0f3460"
                            BorderBrush="#00ff88"
                            BorderThickness="2"
                            CornerRadius="10">
                                        <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained" />
                                        </ScrollViewer>
                                    </Border>
                                </Grid>
                            </Popup>
                        </Grid>
                        <!-- Triggers au niveau du template principal pour le ComboBox -->
                        <ControlTemplate.Triggers>
                            <!-- Désactivé pour tout le ComboBox -->
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
    </Window.Resources>

    <Grid Margin="15">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Colonne gauche : Liste des modèles -->
        <Border Grid.Column="0" Style="{StaticResource CardStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" 
                           Text="📋 Modèles" 
                           Style="{StaticResource TitleStyle}" 
                           FontSize="20"/>

                <ListBox Grid.Row="1"
                         ItemsSource="{Binding Templates}"
                         SelectedItem="{Binding SelectedTemplate}"
                         Background="#0f3460"
                         BorderThickness="0"
                         Foreground="White"
                         FontSize="13">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="5">
                                <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                <TextBlock FontSize="11" Foreground="#a0a0a0">
                                    <Run Text="{Binding BuyIn, StringFormat='{}{0:C}'}"/>
                                    <Run Text=" • "/>
                                    <Run Text="{Binding StartingStack, StringFormat='{}{0:N0} jetons'}"/>
                                </TextBlock>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="2" Margin="0,12,0,0">
                    <Button Content="➕ Nouveau"
                            Command="{Binding NewTemplateCommand}"
                            Height="38"
                            Background="#00ff88"
                            Foreground="#1a1a2e"
                            FontWeight="Bold"
                            Margin="0,4"/>
                    <Button Content="📋 Dupliquer"
                            Command="{Binding DuplicateTemplateCommand}"
                            Height="34"
                            Background="#0f3460"
                            Foreground="White"
                            Margin="0,4"
                            IsEnabled="{Binding SelectedTemplate, Converter={StaticResource NullToBoolConverter}}"/>
                    <Button Content="🗑️ Supprimer"
                            Command="{Binding DeleteTemplateCommand}"
                            Height="34"
                            Background="#e94560"
                            Foreground="White"
                            Margin="0,4"
                            IsEnabled="{Binding SelectedTemplate, Converter={StaticResource NullToBoolConverter}}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Colonne droite : Éditeur ou message de sélection -->
        <Grid Grid.Column="1">
            <!-- Éditeur du template sélectionné -->
            <Border Style="{StaticResource CardStyle}"
                    Visibility="{Binding SelectedTemplate, Converter={StaticResource NullToCollapsedConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Titre -->
                    <TextBlock Grid.Row="0"
                               Text="✏️ ÉDITION DU MODÈLE"
                               FontSize="22"
                               FontWeight="Bold"
                               Foreground="#00ff88"
                               Margin="0,0,0,15"/>

                    <!-- Contenu principal (scrollable) -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- Nom & Type -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Nom du modèle *" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditName, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource TextBoxStyle}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Type" Style="{StaticResource LabelStyle}"/>
                                    <ComboBox SelectedItem="{Binding EditType, UpdateSourceTrigger=PropertyChanged}"
                                              Style="{StaticResource ComboBoxStyle}">
                                        <ComboBox.Items>
                                            <x:Static Member="local:TournamentTemplateType.Cash"/>
                                            <x:Static Member="local:TournamentTemplateType.Freeroll"/>
                                            <x:Static Member="local:TournamentTemplateType.Points"/>
                                        </ComboBox.Items>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>

                            <TextBlock Text="Description" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding EditDescription}"
                                     Style="{StaticResource TextBoxStyle}"
                                     Height="50"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"/>

                            <!-- Section financière (visible si type Cash) -->
                            <Border Visibility="{Binding ShowFinanceSection, Converter={StaticResource BoolToVisibleConverter}}"
                                    Margin="0,12,0,0">
                                <StackPanel>
                                    <TextBlock Text="💰 CONFIGURATION FINANCIÈRE"
                                               Style="{StaticResource TitleStyle}"
                                               Foreground="#ffd700"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                            <TextBlock Text="Buy-in" Style="{StaticResource LabelStyle}"/>
                                            <TextBox Text="{Binding EditBuyIn, UpdateSourceTrigger=PropertyChanged}"
                                                     Style="{StaticResource TextBoxStyle}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="1" Margin="0,0,8,0">
                                            <TextBlock Text="Rake" Style="{StaticResource LabelStyle}"/>
                                            <TextBox Text="{Binding EditRake}" Style="{StaticResource TextBoxStyle}"/>
                                        </StackPanel>
                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Devise" Style="{StaticResource LabelStyle}"/>
                                            <ComboBox SelectedItem="{Binding EditCurrency}"
                                                      Style="{StaticResource ComboBoxStyle}">
                                                <ComboBoxItem Content="EUR" IsSelected="True"/>
                                                <ComboBoxItem Content="USD"/>
                                            </ComboBox>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Configuration technique -->
                            <TextBlock Text="⚙️ CONFIGURATION TECHNIQUE"
                                       Style="{StaticResource TitleStyle}"
                                       Foreground="#00ff88"
                                       Margin="0,12,0,0"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                    <TextBlock Text="Structure de blinds" Style="{StaticResource LabelStyle}"/>
                                    <ComboBox ItemsSource="{Binding BlindStructures}"
                                              SelectedItem="{Binding EditSelectedBlindStructure}"
                                              DisplayMemberPath="Name"
                                              Style="{StaticResource ComboBoxStyle}"/>
                                    <TextBlock Text="Jetons de départ" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditStartingStack}" Style="{StaticResource TextBoxStyle}"/>
                                    <TextBlock Text="Max joueurs" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditMaxPlayers}" Style="{StaticResource TextBoxStyle}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Sièges par table" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditSeatsPerTable}" Style="{StaticResource TextBoxStyle}"/>
                                    <TextBlock Text="Enregistrement tardif (niveaux)" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditLateRegLevels}" Style="{StaticResource TextBoxStyle}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Recaves -->
                            <CheckBox Content="🔄 AUTORISER LES RECAVES"
                                      IsChecked="{Binding EditAllowRebuys}"
                                      Foreground="#ffd700"
                                      FontSize="15"
                                      FontWeight="Bold"
                                      Margin="0,15,0,8"/>

                            <Grid Visibility="{Binding EditAllowRebuys, Converter={StaticResource BoolToVisibleConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                    <TextBlock Text="Montant recave" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditRebuyAmount}"
                                             Style="{StaticResource TextBoxStyle}"
                                             IsEnabled="{Binding ShowFinanceSection}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="0,0,8,0">
                                    <TextBlock Text="Limite (0 = illimité)" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditRebuyLimit}" Style="{StaticResource TextBoxStyle}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Jusqu'au niveau" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditRebuyMaxLevel}" Style="{StaticResource TextBoxStyle}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Add-ons -->
                            <CheckBox Content="➕ AUTORISER LES ADD-ONS"
                                      IsChecked="{Binding EditAllowAddOn}"
                                      Foreground="#00ff88"
                                      FontSize="15"
                                      FontWeight="Bold"
                                      Margin="0,15,0,8"/>

                            <Grid Visibility="{Binding EditAllowAddOn, Converter={StaticResource BoolToVisibleConverter}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                    <TextBlock Text="Montant add-on" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditAddOnAmount}"
                                             Style="{StaticResource TextBoxStyle}"
                                             IsEnabled="{Binding ShowFinanceSection}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="0,0,8,0">
                                    <TextBlock Text="Jetons additionnels" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditAddOnStack}" Style="{StaticResource TextBoxStyle}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Au niveau" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditAddOnAtLevel}" Style="{StaticResource TextBoxStyle}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Bounty -->
                            <CheckBox Content="💀 TOURNOI BOUNTY"
                                      IsChecked="{Binding EditAllowBounty}"
                                      Foreground="#e94560"
                                      FontSize="15"
                                      FontWeight="Bold"
                                      Margin="0,15,0,8"/>

                            <Grid Visibility="{Binding EditAllowBounty, Converter={StaticResource BoolToVisibleConverter}}">
                                <StackPanel MaxWidth="350" HorizontalAlignment="Left">
                                    <TextBlock Text="Montant par élimination" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding EditBountyAmount}"
                                             Style="{StaticResource TextBoxStyle}"
                                             IsEnabled="{Binding ShowFinanceSection}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Boutons Sauvegarder / Annuler -->
                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                Margin="0,15,0,20">
                        <Button Content="💾 SAUVEGARDER"
                                Command="{Binding SaveTemplateCommand}"
                                Width="180" Height="48"
                                Background="#00ff88"
                                Foreground="#1a1a2e"
                                FontSize="16"
                                FontWeight="Bold"
                                Margin="8,0"/>
                        <Button Content="❌ ANNULER"
                                Command="{Binding CancelEditCommand}"
                                Width="140" Height="48"
                                Background="#e94560"
                                Foreground="White"
                                FontSize="16"
                                FontWeight="Bold"
                                Margin="8,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Message quand aucun modèle sélectionné -->
            <Border Style="{StaticResource CardStyle}"
                    Visibility="{Binding SelectedTemplate, Converter={StaticResource NullToVisibleConverter}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="📝" FontSize="100" HorizontalAlignment="Center" Margin="0,0,0,30"/>
                    <TextBlock Text="Sélectionnez un modèle"
                               FontSize="20"
                               Foreground="White"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10"/>
                    <TextBlock Text="ou créez-en un nouveau"
                               FontSize="16"
                               Foreground="#a0a0a0"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>