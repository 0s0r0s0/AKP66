<Window x:Class="PokerTournamentDirector.Views.ChampionshipDashboardView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:PokerTournamentDirector.Converters"
        Title="ðŸ“Š Tableau de bord Championnat" 
        Height="850" Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="#1a1a2e">

    <Window.Resources>
        <!-- Converters -->
        <conv:IntToBoolConverter x:Key="IntToBoolConverter"/>
        <conv:IntToVisibilityConverter x:Key="IntToVisibilityConverter"/>
        <conv:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <conv:PositionChangeConverter x:Key="PositionChangeConverter"/>

        <Style x:Key="TabButton" TargetType="RadioButton">
            <Setter Property="Background" Value="#0f3460"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,15"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="10,10,0,0"
                                Padding="{TemplateBinding Padding}"
                                Margin="0,0,5,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background" Value="#00ff88"/>
                    <Setter Property="Foreground" Value="#1a1a2e"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#16213e"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock Text="ðŸ“Š Tableau de bord Championnat"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="#00ff88"/>
                <TextBlock Text="{Binding Championship.Name, Mode=OneWay, FallbackValue='Chargement...'}"
                           FontSize="20"
                           Foreground="White"
                           Margin="0,5,0,0"/>
                <TextBlock Foreground="Gray" FontSize="14" Margin="0,3,0,0">
                    <Run Text="Saison"/>
                    <Run Text="{Binding Championship.Season, Mode=OneWay, FallbackValue='--'}"/>
                    <Run Text=" â€¢ "/>
                    <Run Text="{Binding Championship.Matches.Count, Mode=OneWay, FallbackValue='0'}"/>
                    <Run Text=" manches"/>
                </TextBlock>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="ðŸ”„ Recalculer"
                        Command="{Binding RefreshStandingsCommand}"
                        Background="#0f3460"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="15,10"
                        Margin="0,0,10,0"
                        Cursor="Hand"
                        FontSize="14"/>
                <Button Content="ðŸ”„ RafraÃ®chir" 
        Command="{Binding RefreshDataCommand}"
        Width="120" Height="35"
        Background="#00ff88" Foreground="#0a192f"
        Margin="10"/>
                <Button Content="ðŸ“„ Export PDF"
                        Command="{Binding ExportStandingsPdfCommand}"
                        Background="#00ff88"
                        Foreground="#1a1a2e"
                        BorderThickness="0"
                        Padding="15,10"
                        Cursor="Hand"
                        FontSize="14"
                        FontWeight="SemiBold"/>
            </StackPanel>
        </Grid>

        <!-- Tabs -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
            <RadioButton Content="ðŸ“ˆ Classement" 
                         GroupName="Tabs"
                         Style="{StaticResource TabButton}"
                         IsChecked="True"
                         Command="{Binding SwitchTabCommand}"
                         CommandParameter="0"/>
            <RadioButton Content="ðŸ“Š Statistiques" 
                         GroupName="Tabs"
                         Style="{StaticResource TabButton}"
                         Command="{Binding SwitchTabCommand}"
                         CommandParameter="1"/>
            <RadioButton Content="ðŸŽ¯ Manches" 
                         GroupName="Tabs"
                         Style="{StaticResource TabButton}"
                         Command="{Binding SwitchTabCommand}"
                         CommandParameter="2"/>
            <RadioButton Content="ðŸ‘¥ Joueurs" 
                         GroupName="Tabs"
                         Style="{StaticResource TabButton}"
                         Command="{Binding SwitchTabCommand}"
                         CommandParameter="3"/>
            <RadioButton Content="ðŸ“ Logs" 
                         GroupName="Tabs"
                         Style="{StaticResource TabButton}"
                         Command="{Binding SwitchTabCommand}"
                         CommandParameter="4"/>
        </StackPanel>

        <!-- Tab Content Container -->
        <Border Grid.Row="2" 
                Background="#0f3460"
                CornerRadius="0,10,10,10"
                BorderBrush="#00ff88"
                BorderThickness="2"
                Padding="20">

            <!-- REMPLACE tout le ContentControl par : -->
            <ContentControl Content="{Binding SelectedTabIndex}">
                <ContentControl.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <!-- ONGLET 1 : CLASSEMENT -->
                            <Grid>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}" Value="0">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>

                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                                    <TextBlock Text="Afficher:" Foreground="White" FontSize="14" VerticalAlignment="Center" Margin="0,0,10,0"/>

                                    <ComboBox ItemsSource="{Binding DataContext.StandingPeriods, RelativeSource={RelativeSource AncestorType=Window}}"
                                  SelectedItem="{Binding DataContext.SelectedStandingPeriod, RelativeSource={RelativeSource AncestorType=Window}}"
                                  Width="150" Height="35" FontSize="14" Margin="0,0,10,0"/>

                                    <ComboBox ItemsSource="{Binding DataContext.AvailablePeriods, RelativeSource={RelativeSource AncestorType=Window}}"
                                  SelectedItem="{Binding DataContext.SelectedPeriod, RelativeSource={RelativeSource AncestorType=Window}}"
                                  Width="200" Height="40" FontSize="14"
                                  Background="#0f3460" Foreground="White"
                                  BorderBrush="#00ff88" BorderThickness="2">
                                        <ComboBox.ItemContainerStyle>
                                            <Style TargetType="ComboBoxItem">
                                                <Setter Property="Foreground" Value="Black"/>
                                            </Style>
                                        </ComboBox.ItemContainerStyle>
                                    </ComboBox>
                                </StackPanel>

                                <DataGrid Grid.Row="1" ItemsSource="{Binding DataContext.Standings, RelativeSource={RelativeSource AncestorType=Window}}"
                              AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True"
                              Background="Transparent" BorderThickness="0"
                              GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#16213e"
                              RowBackground="#0f3460" AlternatingRowBackground="#16213e"
                              Foreground="White" FontSize="14">
                                    <DataGrid.ColumnHeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#16213e"/>
                                            <Setter Property="Foreground" Value="#00ff88"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="Padding" Value="12"/>
                                        </Style>
                                    </DataGrid.ColumnHeaderStyle>
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Pos" Binding="{Binding CurrentPosition}" Width="60"/>
                                        <DataGridTextColumn Header="Joueur" Binding="{Binding Player.Name}" Width="2*"/>
                                        <DataGridTextColumn Header="Points" Binding="{Binding TotalPoints}" Width="*"/>
                                        <DataGridTextColumn Header="Manches" Binding="{Binding MatchesPlayed}" Width="*"/>
                                        <DataGridTextColumn Header="Victoires" Binding="{Binding Victories}" Width="*"/>
                                        <DataGridTextColumn Header="Top 3" Binding="{Binding Top3Finishes}" Width="*"/>
                                        <DataGridTextColumn Header="Moy." Binding="{Binding AveragePosition, StringFormat=N1}" Width="*"/>
                                        <DataGridTextColumn Header="Bounties" Binding="{Binding TotalBounties}" Width="*"/>
                                        <DataGridTextColumn Header="Gains" Binding="{Binding TotalWinnings, StringFormat=C0}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </Grid>

                            <!-- ONGLET 2 : STATISTIQUES -->
                            <Grid>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}" Value="1">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>

                                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                                    <StackPanel>
                                        <Grid Margin="0,0,0,20">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="200"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Joueur :" VerticalAlignment="Center" Foreground="White" FontSize="14" Margin="0,0,10,0"/>
                                            <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding DataContext.StatsPlayerList, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedItem="{Binding DataContext.SelectedStatsPlayer, RelativeSource={RelativeSource AncestorType=Window}}"
                                          Height="40" FontSize="14"
                                          Background="#0f3460" Foreground="White"
                                          BorderBrush="#00ff88" BorderThickness="2">
                                                <ComboBox.ItemContainerStyle>
                                                    <Style TargetType="ComboBoxItem">
                                                        <Setter Property="Foreground" Value="Black"/>
                                                    </Style>
                                                </ComboBox.ItemContainerStyle>
                                            </ComboBox>
                                        </Grid>

                                        <DataGrid ItemsSource="{Binding DataContext.PlayerStatistics, RelativeSource={RelativeSource AncestorType=Window}}" 
                                      AutoGenerateColumns="False"
                                      Background="#16213e" RowBackground="#16213e" AlternatingRowBackground="#1a2742"
                                      GridLinesVisibility="Horizontal" HeadersVisibility="Column" IsReadOnly="True">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Joueur" Binding="{Binding PlayerName}" Width="*"/>
                                                <DataGridTextColumn Header="Manches" Binding="{Binding MatchesPlayed}" Width="80"/>
                                                <DataGridTextColumn Header="Victoires" Binding="{Binding Victories}" Width="80"/>
                                                <DataGridTextColumn Header="% Vict." Binding="{Binding VictoryPercentage, StringFormat=N1}" Width="80"/>
                                                <DataGridTextColumn Header="Top 3" Binding="{Binding Top3Count}" Width="70"/>
                                                <DataGridTextColumn Header="Pos. Moy" Binding="{Binding AveragePosition, StringFormat=N1}" Width="80"/>
                                                <DataGridTextColumn Header="Points" Binding="{Binding TotalPoints}" Width="80"/>
                                                <DataGridTextColumn Header="Bounties" Binding="{Binding TotalBounties}" Width="80"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>

                            <!-- ONGLET 3 : MANCHES -->
                            <Grid>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding}" Value="2">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <DataGrid Grid.Row="0" 
                              ItemsSource="{Binding DataContext.Matches, RelativeSource={RelativeSource AncestorType=Window}}" 
                              SelectedItem="{Binding DataContext.SelectedMatch, RelativeSource={RelativeSource AncestorType=Window}}"
                              AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True"
                              Background="Transparent" BorderThickness="0"
                              GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#16213e"
                              RowBackground="#0f3460" AlternatingRowBackground="#16213e"
                              Foreground="White" FontSize="14">
                                    <DataGrid.ColumnHeaderStyle>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#16213e"/>
                                            <Setter Property="Foreground" Value="#00ff88"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="Padding" Value="12"/>
                                        </Style>
                                    </DataGrid.ColumnHeaderStyle>
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="#" Binding="{Binding MatchNumber}" Width="60"/>
                                        <DataGridTextColumn Header="Date" Binding="{Binding MatchDate, StringFormat=dd/MM/yyyy}" Width="*"/>
                                        <DataGridTextColumn Header="Tournoi" Binding="{Binding Tournament.Name}" Width="3*"/>
                                        <DataGridTextColumn Header="Coefficient" Binding="{Binding Coefficient}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <Button Grid.Row="1" Content="ðŸ“‹ Voir dÃ©tails de la manche"
                            Command="{Binding DataContext.ViewMatchDetailsCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                            HorizontalAlignment="Right" Margin="0,15,0,0" Padding="20,10"
                            Background="#00ff88" Foreground="#1a1a2e" FontWeight="Bold"/>
                            </Grid>

                            <!-- ONGLET 4 : JOUEURS -->
                            <Grid>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.SelectedTabIndex}" Value="3">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                                    <TextBox Text="{Binding DataContext.PlayerSearchText, UpdateSourceTrigger=PropertyChanged}"
                                 Width="300" Height="40"
                                 Background="#16213e" Foreground="White"
                                 BorderBrush="#00ff88" BorderThickness="1"
                                 Padding="10" FontSize="14" VerticalContentAlignment="Center"/>
                                    <Button Content="ðŸ” Rechercher" Command="{Binding DataContext.SearchPlayersCommand}"
                                Margin="10,0,0,0" Padding="15,10"
                                Background="#00ff88" Foreground="#1a1a2e" FontWeight="Bold"/>
                                </StackPanel>

                                <ListBox Grid.Row="1" ItemsSource="{Binding DataContext.Players}" SelectedItem="{Binding DataContext.SelectedPlayer}"
                             Background="Transparent" BorderThickness="0" FontSize="14">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#16213e" CornerRadius="8" Padding="15" Margin="0,5">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="60"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="{Binding DataContext.CurrentPosition}" FontSize="24" FontWeight="Bold"
                                                   Foreground="#00ff88" VerticalAlignment="Center"/>
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding DataContext.Player.Name}" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                                        <TextBlock Foreground="Gray" FontSize="12">
                                                <Run Text="{Binding DataContext.TotalPoints}"/> <Run Text="pts â€¢"/>
                                                <Run Text="{Binding DataContext.MatchesPlayed}"/> <Run Text="manches â€¢"/>
                                                <Run Text="{Binding DataContext.Victories}"/> <Run Text="victoires"/>
                                                        </TextBlock>
                                                    </StackPanel>
                                                    <Button Grid.Column="2" Content="ðŸ“Š DÃ©tails"
                                                Command="{Binding DataContext.ViewPlayerDetailsCommand, RelativeSource={RelativeSource AncestorType=Grid}}"
                                                Background="#0f3460" Foreground="White" Padding="10,5"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>

                            <!-- ONGLET 5 : LOGS -->
                            <Grid>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.SelectedTabIndex}" Value="4">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                    <TextBlock Text="Filtrer:" Foreground="White" FontSize="14" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <ComboBox ItemsSource="{Binding DataContext.LogActions}" SelectedItem="{Binding DataContext.LogFilterAction}"
                                  Width="250" Height="35" FontSize="14"/>
                                </StackPanel>

                                <ListBox Grid.Row="1" ItemsSource="{Binding DataContext.Logs}"
                             Background="Transparent" BorderThickness="0" FontSize="13">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#16213e" CornerRadius="5" Padding="12" Margin="0,3">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="150"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Text="{Binding DataContext.Timestamp, StringFormat=dd/MM/yyyy HH:mm:ss}"
                                                   Foreground="Gray" FontSize="12"/>
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding DataContext.Action}" FontWeight="Bold" Foreground="#00ff88"/>
                                                        <TextBlock Text="{Binding DataContext.Description}" Foreground="White" TextWrapping="Wrap" Margin="0,3,0,0"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Grid>
                    </DataTemplate>
                </ContentControl.ContentTemplate>
            </ContentControl>
        </Border>
    </Grid>
</Window>
